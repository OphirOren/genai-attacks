name: Release Action

on:
  push:
    branches:
      - main

jobs:
  versioning:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        # In order for the GitVersion to properly work you need to clone the repository with the entire history
        fetch-depth: 0

    - name: Install GitVersion
      uses: gittools/actions/gitversion/setup@v1.1.1
      with:
        versionSpec: "5.x"

    - name: Install GitVersion
      uses: gittools/actions/gitversion/execute@v1.1.1
      id: gitversion

    - name: Output version to log
      run: echo "Version ${{ steps.gitversion.outputs.semver }}"

    - name: Build with mdBook
      run: mdbook build

    - name: Setup Pages
      id: pages
      uses: actions/configure-pages@v5

    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: ./book

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        branch: gh-pages
        folder: book
